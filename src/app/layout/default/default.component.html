<app-top-progress-bar></app-top-progress-bar>
<nz-layout class="min-screen-full-height">
  <!--非混合模式侧边栏固定时占位-->
  <nz-sider
    *ngIf="!isMixiMode && (themesOptions$ | async)!.mode === 'side' && (isOverMode$ | async) === false && (themesOptions$ | async)!.hasNavArea && isFixedLeftNav"
    nzBreakpoint="lg"
    [nzCollapsed]="isCollapsed$ | async"
    [nzCollapsedWidth]="48"
    [nzTheme]="(themesOptions$ | async)!.theme"
    [nzWidth]="208"
  />

  <!--非混合模式侧边栏-->
  <nz-sider
    *ngIf="!isMixiMode && (themesOptions$ | async)!.mode === 'side' && (isOverMode$ | async) === false && (themesOptions$ | async)!.hasNavArea"
    id="menuNav"
    class="menu-sidebar"
    nzBreakpoint="lg"
    [class.left-nav-fixed]="isFixedLeftNav"
    [nzCollapsed]="isCollapsed$ | async"
    [nzCollapsedWidth]="48"
    [nzCollapsible]="true"
    [nzTheme]="(themesOptions$ | async)!.theme"
    [nzTrigger]="trigger"
    [nzWidth]="208"
    (nzCollapsedChange)="changeCollapsed($event)"
  >
    <app-side-nav />
  </nz-sider>

  <!--混合模式顶部菜单header-->
  <nz-header *ngIf="isMixiMode && themesOptions.hasTopArea" class="animate-02 dark-top-nav-bg top-fixed screen-full-width">
    <app-tool-bar>
      <ng-container *ngIf="isOverMode" left>
        <i class="trigger" nz-icon [nzType]="(isCollapsed$ | async) ? 'menu-unfold' : 'menu-fold'" (click)="changeCollapsed(!isCollapsed)"></i>
      </ng-container>

      <ng-container *ngIf="!isOverMode" left>
        <div class="left-start-center flex-1" style="z-index: 100">
          <img class="m-l-10" alt="" src="assets/imgs/logo.svg" style="max-height: 32px; max-width: 54px" />
          <span class="sp-18 m-r-25 ng17color">Ant Design Pro</span>
          <div class="flex-1">
            <app-nav-bar *ngIf="(themesOptions$ | async)!.splitNav" [isMixiHead]="true" />
          </div>
        </div>
      </ng-container>
      <ng-container right>
        <app-layout-head-right-menu />
      </ng-container>
    </app-tool-bar>
  </nz-header>

  <nz-layout [style]="{ marginTop: isMixiMode && themesOptions.hasTopArea ? '48px' : 0 }">
    <!--sider模式的 header-->
    <nz-header
      *ngIf="!isMixiMode && themesOptions.hasTopArea && themesOptions.mode === 'side'"
      style="transition: width 0.2s"
      [ngClass]="{
        'full-with': !themesOptions.hasNavArea,
        fixed: themesOptions.fixedHead,
        'fixed-collapsed': themesOptions.fixedHead && (isCollapsed$ | async),
        'fixed-over-mode': themesOptions.fixedHead && (isOverMode$ | async)
      }"
    >
      <ng-container *ngTemplateOutlet="headerTpl" />
    </nz-header>
    <!--top模式header-->
    <nz-header
      *ngIf="!isMixiMode && themesOptions.hasTopArea && themesOptions.mode === 'top'"
      [ngClass]="{
        'dark-top-nav-bg': (themesOptions$ | async)!.theme === 'dark',
        'top-fixed': themesOptions.fixedHead
      }"
    >
      <ng-container *ngTemplateOutlet="headerTpl" />
    </nz-header>

    <!--混合模式sider固定时占位-->
    <nz-sider
      *ngIf="isFixedLeftNav && isMixiMode && themesOptions.hasNavArea && (isOverMode$ | async) === false && ((mixiModeLeftNav | async)!.length > 0 || !themesOptions.splitNav)"
      nzBreakpoint="lg"
      nzNoAnimation
      [nzCollapsed]="isCollapsed$ | async"
      [nzCollapsedWidth]="48"
      [nzTheme]="(isNightTheme$ | async) ? 'dark' : 'light'"
      [nzWidth]="208"
    />
    <!--混合模式sider-->
    <nz-sider
      *ngIf="isMixiMode && themesOptions.hasNavArea && (isOverMode$ | async) === false && ((mixiModeLeftNav | async)!.length > 0 || !themesOptions.splitNav)"
      class="menu-sidebar"
      nzBreakpoint="lg"
      nzNoAnimation
      [class.mixi-left-nav-fixed]="isFixedLeftNav"
      [class.t-0]="!themesOptions.hasTopArea"
      [nzCollapsed]="isCollapsed$ | async"
      [nzCollapsedWidth]="48"
      [nzCollapsible]="true"
      [nzTheme]="(isNightTheme$ | async) ? 'dark' : 'light'"
      [nzTrigger]="trigger"
      [nzWidth]="208"
      (nzCollapsedChange)="changeCollapsed($event)"
    >
      <div class="mix-sider-height" style="overflow: hidden auto"><app-nav-bar [isMixiLeft]="(themesOptions$ | async)!.splitNav" /></div>
    </nz-sider>

    <nz-layout>
      <nz-content [ngStyle]="{ marginTop: contentMarginTop }">
        <div>
          <app-tab *ngIf="(themesOptions$ | async)?.isShowTab"></app-tab>
          <div [@fadeRouteAnimation]="prepareRoute(outlet)">
            <router-outlet #outlet="outlet"></router-outlet>
          </div>
        </div>
      </nz-content>
      <nz-footer *ngIf="themesOptions.hasFooterArea" class="text-center">Ant Design ©2022 Implement By 华舰</nz-footer>
    </nz-layout>
  </nz-layout>
</nz-layout>

<app-setting-drawer />

<app-chat *ngIf="showChats" (changeShows)="showChats = false" />

<ng-template #trigger>
  <ul nz-menu nzMode="inline" [nzSelectable]="false" [nzTheme]="isMixiMode && (isOverMode$ | async) === false ? 'light' : (themesOptions$ | async)!.theme">
    <li
      class="trigger-top-border m-0"
      nz-menu-item
      [ngStyle]="{
        'border-top-color': (!isMixiMode && (themesOptions$ | async)?.theme) === 'dark' || (isNightTheme$ | async) ? 'rgba(0,0,0,0.25)' : 'rgb(240,240,240)'
      }"
      [nzPaddingLeft]="16"
    >
      <i class="sp-16" nz-icon [nzType]="(isCollapsed$ | async) ? 'menu-unfold' : 'menu-fold'"></i>
    </li>
  </ul>
</ng-template>
<ng-template #headerTpl>
  <app-tool-bar>
    <ng-container *ngIf="isOverMode || (themesOptions$ | async)!.mode === 'side'; else topHeadTpl" left>
      <i id="trigger" class="trigger" nz-icon [nzType]="(isCollapsed$ | async) ? 'menu-unfold' : 'menu-fold'" (click)="changeCollapsed(!isCollapsed)"></i>
    </ng-container>
    <ng-template #topHeadTpl>
      <div class="left-start-center flex-1" style="z-index: 100">
        <ng-container *ngIf="(themesOptions$ | async)!.hasNavHeadArea">
          <img class="m-l-10" alt="" src="assets/imgs/logo.svg" style="max-height: 32px; max-width: 54px" />
          <span class="sp-18 m-r-8 ng17color">Ant Design</span>
        </ng-container>
        <div class="flex-1">
          <app-nav-bar />
        </div>
      </div>
    </ng-template>
    <ng-container right>
      <app-layout-head-right-menu />
    </ng-container>
  </app-tool-bar>
</ng-template>
<app-nav-drawer #navDrawer />
